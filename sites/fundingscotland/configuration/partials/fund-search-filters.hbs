{{#*inline "term_checkbox"}}
<div class="mdc-form-field">
  <div class="mdc-checkbox">
    <input type="checkbox" class="mdc-checkbox__native-control" id="{{instance_id}}_{{field}}_{{slug}}" name="{{#compare field "===" "type"}}{{field}}{{else}}{{field}}[]{{/compare}}" value="{{slug}}"{{#if (contains selected slug)}} checked{{/if}} onchange="this.form.submit();" />
    <div class="mdc-checkbox__background">
      <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
        <path class="mdc-checkbox__checkmark-path" fill="none" stroke="white" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
      </svg>
      <div class="mdc-checkbox__mixedmark"></div>
    </div>
  </div>
  <label for="{{instance_id}}_{{field}}_{{slug}}">
    {{{default value.key value}}}
  </label>
</div>
{{/inline}}

{{#*inline "mdc_list_checkbox"}}
  <li class="mdc-list-item {{#if isParent}}checkbox-list-group-parent{{/if}} {{#if parent}}checkbox-list-group-child{{/if}}" 
      {{#if first}}tabindex="0"{{/if}} role="checkbox" 
      {{#if isParent}}data-checkbox-group="{{name}}"{{else}}aria-checked="{{checked}}"{{/if}}
      {{#if collapseParent}}data-checkbox-collapse-parent="{{collapseParent}}"{{/if}}
      {{#if collapseAlwaysHide}}data-checkbox-collapse-always-hide="true"{{/if}}>
    {{{label}}}
    <div class="mdc-checkbox mdc-list-item__meta">
      <input type="checkbox" class="mdc-checkbox__native-control" 
          {{#unless isParent}}name="{{name}}"{{/unless}} value="{{value}}" 
          {{#if parent}}data-checkbox-group-parent="{{parent}}"{{/if}}
          id="cb-{{name}}-{{value}}" {{#if checked}}checked{{/if}}>
      <div class="mdc-checkbox__background">
        <svg class="mdc-checkbox__checkmark"
            viewBox="0 0 24 24">
          <path class="mdc-checkbox__checkmark-path"
              fill="none"
              d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
        </svg>
        <div class="mdc-checkbox__mixedmark"></div>
      </div>
    </div>
  </li>
{{/inline}}

<div class="mdc-drawer__content">
  <!-- <h2 class="mdc-drawer__content-heading hide-sm mdc-drawer--occasional-ie11">Search funds</h2> -->
  <form action="/search" method="GET" class="search-form">
    <div class="header mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon mdc-text-field-tt" data-mdc-auto-init="MDCTextField">
      <span class="far fa-search mdc-text-field__icon" tabindex="0" role="button"></span>
      <input type="text" id="what-primary-content" name="keywords" class="mdc-text-field__input" placeholder="" data-lpignore="true" data-typeahead='{
        "typeaheadOptions": {
          "highlight": true,
          "minlength": 0
        },
        "outputs": [
          {
            "type": "prop",
            "options": {
              "selectorTemplate": "[name=\"\{{item.datasetName}}\"][value=\"\{{item.value}}\"]",
              "prop": "checked",
              "valueTemplate": "checked"
            }
          }
        ],
        "datasets": [
          {{#each @root.context.metaData.terms}}
            {{#each termGroups}}
              {
                "name": {{{stringify @../key}}},
                "templates": {
                  {{#compare (length (getKeys ../termGroups)) 1}}
                    "header": "<h3>{{{../label}}}</h3>"
                  {{else}}
                    "header": "<h3>{{{../label}}} &gt; {{{label}}}</h3>"
                  {{/compare}}
                },
                "display": "label",
                "items": [
                  {{#each terms}}
                  {
                  "label": {{{stringify this}}},
                  "value": {{{stringify @key}}}
                  }{{#unless @last}},{{/unless}}
                  {{/each}}
                ]
              }{{#unlessAll @last @../last}},{{/unlessAll}}
            {{/each}}
          {{/each}}
        ]
      }'>
      <label for="what-primary-content" class="mdc-floating-label">
        Keywords
      </label>
      <div class="mdc-line-ripple"></div>
    </div>
        
    {{#each @root.context.metaData.terms}}
      <div class="mdc-list-group">
        <h3 class="mdc-list-group__subheader cursor-pointer noselect" 
            data-checkbox-collapse="{{@key}}">
          {{{label}}}
        </h3>
        {{#compare (length (getKeys termGroups)) 1}}
          <ul class="mdc-list mdc-list--dense" role="group" aria-label="{{label}}" data-mdc-auto-init="MDCList">
            {{#each termGroups}}
              {{#each terms}}
                {{> mdc_list_checkbox
                    name=@../../key
                    value=@key
                    label=this
                    checked=false
                    first=@first
                    collapseParent=@../../key}}
              {{/each}}
            {{/each}}
            <li class="mdc-list-item cursor-pointer noselect" data-checkbox-collapse-trigger="{{@key}}">
              <i class="fas fa-ellipsis-h fa-2x pull-centre"></i>
            </li>
          </ul>
        {{else}}
          <ul class="mdc-list mdc-list--dense" role="group" aria-label="{{label}}" data-mdc-auto-init="MDCList">
            {{#each termGroups}}
              {{> mdc_list_checkbox
                  name=(concat @../key '-' @key)
                  isParent=true
                  value=@key
                  label=label
                  checked=false
                  first=@first
                  collapseParent=@../key
                  collapseAlwaysHide=true}}
              {{#each terms}}
                {{> mdc_list_checkbox
                    name=@../../key
                    parent=(concat @../../key '-' @../key)
                    value=@key
                    label=this
                    checked=false
                    first=false
                    collapseParent=@../../key}}
              {{/each}}
            {{/each}}
            <li class="mdc-list-item cursor-pointer noselect" data-checkbox-collapse-trigger="{{@key}}">
              <i class="fas fa-ellipsis-h fa-2x pull-centre"></i>
            </li>
          </ul>
        {{/compare}}
      </div>
    {{/each}}

    {{!--
    <a href="/search/advanced{{@root.request.url.search}}" class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11">
      Advanced filters
      <span class="mdc-icon-toggle pull-right">
        <i class="far fa-chevron-right" aria-hidden="true"></i>
      </span>
    </a>

    {{#each (split "activities,beneficiaries,geographical_areas_funded" ",")}}
      {{#if (getProperty @root.request.params.query this) ~}}
        <a href="/search/advanced{{@root.request.url.search}}" class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11">
          {{getProperty @root.context.metaData.termTypeLabels (concat this ".plural")}}
          <span class="mdc-typography--caption">
            {{length (arrayify (getProperty @root.request.params.query this))}} selected
          </span>
          <span class="mdc-icon-toggle pull-right">
            <i class="far fa-chevron-right" aria-hidden="true"></i>
          </span>
        </a>
        {{#each (arrayify (getProperty @root.request.params.query this)) ~}}
          <input type="hidden" name="{{../this}}[]" value="{{this}}" />
        {{/each ~}}
      {{/if ~}}
    {{/each ~}}

    {{#each (split "fund_status,charities_only,type_of_cost,type_of_funding" ",")}}
      <h3 class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11" data-collapse-target="#{{../instance_id}}-{{this}}-collapse" role="button" aria-pressed="false" aria-label="Show {{getProperty @root.context.metaData.termTypeLabels (concat this ".plural")}}" tabindex="0">
        {{getProperty @root.context.metaData.termTypeLabels (concat this ".plural")}}
        {{#if (getProperty @root.request.params.query this) ~}}
        <span class="mdc-typography--caption"{{#if (getProperty @root.request.params.query this)}} style="display: none;"{{/if}}>
          {{length (arrayify (getProperty @root.request.params.query this))}} selected
        </span>
        {{/if ~}}
        <span class="mdc-icon-toggle pull-right">
          <span class="far {{#if (getProperty @root.request.params.query this)}}fa-chevron-up{{else}}fa-chevron-down{{/if}}" aria-hidden="true"></span>
        </span>
      </h3>
      <div class="mdc-drawer--occasional-ie11" id="{{../instance_id}}-{{this}}-collapse"{{#unless (getProperty @root.request.params.query this)}} style="display: none;"{{/unless}}>
        {{#each (getProperty @root.data.supplimentaryResponses.types.aggregations (concat this "_slugs.buckets")) ~}}
          {{#if key ~}}
            {{> term_checkbox slug=key field=../this selected=(getProperty @root.request.params.query ../this) instance_id=../../instance_id value=(lookup (getProperty @root.data.supplimentaryResponses.types.aggregations (concat ../this ".buckets")) @index)}}
          {{/if ~}}
        {{/each ~}}
      </div>
    {{/each}}
    --}}
    <div class="h-margin v-margin mdc-drawer--occasional-ie11">
      <button class="mdc-button mdc-button--raised mdc-button--large mdc-button--fullwidth mdc-ripple-surface mdc-ripple-surface--primary" type="submit" id="{{instance_id}}-search-submit" data-mdc-auto-init="MDCRipple">
        <span class="far fa-search-plus fa-fw mdc-list-item__graphic" aria-hidden="true"></span>
        Filter
      </button>
    </div>
  </form>
</div>