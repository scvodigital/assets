{
  "function_score": {
    "query": {
      "bool": {
        "must": [
          {
            "bool": {
              "filter": [
                {{#if @root.data.currentSite.fixedFilters.type_of_cost ~}}
                  {{>queries_terms field="type_of_cost_slug" terms=@root.data.currentSite.fixedFilters.type_of_cost}},
                {{/if ~}}
                {{#if @root.data.currentSite.fixedFilters.type_of_funding ~}}
                  {{>queries_terms field="type_of_funding_slug" terms=@root.data.currentSite.fixedFilters.type_of_funding}},
                {{/if ~}}
                {{#if @root.data.currentSite.fixedFilters.source_of_fund ~}}
                  {{>queries_terms field="source_of_fund_slug" terms=@root.data.currentSite.fixedFilters.source_of_fund}},
                {{/if ~}}
                {{#if @root.data.currentSite.fixedFilters.activities ~}}
                  {{>queries_terms field="activities_slugs" terms=@root.data.currentSite.fixedFilters.activities}},
                {{/if}}
                {{#if @root.data.currentSite.fixedFilters.beneficiaries ~}}
                  {{>queries_terms field="beneficiaries_slugs" terms=@root.data.currentSite.fixedFilters.beneficiaries}},
                {{/if}}
                {{#if @root.data.currentSite.fixedFilters.geographical_areas_funded ~}}
                  {{>queries_terms field="geographical_areas_funded_slugs" terms=@root.data.currentSite.fixedFilters.geographical_areas_funded}},
                {{/if ~}}
                {{#if @root.data.currentSite.fixedFilters.region_group ~}}
                  {{>queries_terms field="region_group_slug" terms=@root.data.currentSite.fixedFilters.region_group}},
                {{/if ~}}
                {{>queries_do_nothing}}
              ],
              "must_not": [
                {{#unless showHidden}}
                {{#if @root.data.profile.hidden}}
                  {
                    "ids": {
                      "type": "fundingscotland-fund",
                      "values": {{{stringify (getKeys @root.data.profile.hidden)}}}
                    }
                  }
                {{/if}}
                {{/unless}}
              ]
            }
          },
          {
            {{> @partial-block}}
          }
        ]
      }
    },
    "script_score" : {
      "script" : {
        "source": "_score + (doc['boost'].value)"
      }
    }
  }
}