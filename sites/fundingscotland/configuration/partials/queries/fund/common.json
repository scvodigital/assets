{
  "function_score": {
    "query": {
      "bool": {
        "must": [
          {
            "bool": {
              "filter": [
                {{#if @root.data.currentSite.fixedFilters}}
                  {{#each @root.data.currentSite.fixedFilters}}
                    {{>queries_terms field=@key terms=this}}
                    {{#unless @last}},{{/unless}}
                  {{/each}}
                {{/if}}
              ],
              "must_not": [
                {{#unless showHidden}}
                {{#if @root.data.profile.hidden}}
                  {
                    "ids": {
                      "type": "fundingscotland-fund",
                      "values": {{{stringify (getKeys @root.data.profile.hidden)}}}
                    }
                  }
                {{/if}}
                {{/unless}}
              ]
            }
          },
          {
            {{> @partial-block}}
          }
        ]
      }
    },
    "script_score" : {
      "script" : {
        "source": "_score + (doc['boost'].value)"
      }
    }
  }
}