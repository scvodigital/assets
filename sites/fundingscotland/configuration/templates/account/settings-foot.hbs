<script>
  $(document).ready(function() {
    var $changePassword = $('#change-password');
    var $password1 = $('#change-password-password');
    var $password2 = $('#change-password-confirm');

    $changePassword.on('click', changePassword);
    $password1.on('keypress', function(evt) {
      if (evt.which === 13) {
        $password2.focus();
      }
    });
    $password2.on('keypress', function(evt) {
      if (evt.which === 13) {
        changePassword();
      }
    });

    function changePassword() {
      var password1 = $password1.val();
      var password2 = $password2.val();
      fundingscotland.disable([$changePassword, $password1, $password2]);

      fundingscotland.auth.changePassword(password1, password2).then(function() {
        fundingscotland.snackbarShow({
          message: 'Password changed, please wait',
        });
        window.setTimeout(function() {
          window.location.reload();
        }, 1000);
      }).catch(function(err) {
        fundingscotland.disable([$changePassword, $password1, $password2], false);
        $password1.val('');
        $password2.val('');
        $password1.focus();
        fundingscotland.snackbarShow({
          message: err.message || 'There was a problem changing your password',
          backgroundColor: '#dd4b39'
        });
        if (err.code === 'auth/requires-recent-login') {
          window.setTimeout(function() {
            window.location.href = '/sign-in?reauth=true';
          }, 1000);
        }
        return;
      });
    }
  });
</script>
