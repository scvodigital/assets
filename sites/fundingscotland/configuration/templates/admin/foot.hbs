<script>
  $('#admin').on('change', function(evt) {
    $.ajax({
      url: '/admin/set-administrator',
      type: 'POST',
      data: {
        admin: $(evt.currentTarget).prop('checked') ? 'true' : 'false',
        uid: {{{safeStringify @root.data.userAuth.uid}}}
      },
      dataType: 'json',
      success: function(data, status, xhr) {
        fundingscotland.componentsInitialiser.snackbar.show({ message: 'Updated admin status' });
      },
      error: function(xhr, status, err) {
        fundingscotland.componentsInitialiser.snackbar.show({ message: 'Error updating admin status: ' + err });
      }
    });
  });

  $('[data-partition-active]').on('change', function(evt) {
    var $o = $(evt.currentTarget);
    $.ajax({
      url: '/admin/update-partition',
      type: 'POST',
      data: {
        campaign: $o.data('campaign'),
        email: $o.data('email'),
        partition: $o.data('partition'),
        active: $(evt.currentTarget).prop('checked') ? 1 : 0
      },
      dataType: 'json',
      success: function(data, status, xhr) {
        fundingscotland.componentsInitialiser.snackbar.show({ message: 'Updated partition' });
      },
      error: function(xhr, status, err) {
        fundingscotland.componentsInitialiser.snackbar.show({ message: 'Error updating partition: ' + err });
      }
    });
  });

  $('[data-send-test]').on('click', function(evt) {
    var campaign = $(evt.currentTarget).data('send-test');
    var email = $('#' + campaign + '-test-email').val();
    var lastSent = $('#' + campaign + '-test-last-sent').val();
    var dontSend = $('#' + campaign + '-test-dont-send').val();
    var url = 'https://emailer.scvo.net/send-test/' + campaign + '/' + email + '?';

    var params = [
      'override=' + encodeURIComponent({{{safeStringify @root.data.auth.email}}})
    ];
    if (lastSent) { params.push('lastsent=' + encodeURIComponent(lastSent)); }
    if (dontSend) { params.push('dontSend=' + encodeURIComponent(dontSend)); }

    var win = window.open(url + params.join('&'), '_blank');
    win.focus();
  });
</script>