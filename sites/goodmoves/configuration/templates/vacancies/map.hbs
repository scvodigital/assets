{{#*inline "marker"}}
<marker style="display:none;" data-map="fullMap" data-lat="{{lat}}" data-lng="{{lng}}" data-title="{{source.title}}">
  {{>vacancy_map source}}
</marker>
{{/inline}}

{{#if @root.data.search_data.map_results.pagination.totalResults ~}}
<div id="detailed-results-container" class="container-content container-map">
  <div id="map-full" data-map-name="fullMap" data-map-clustered-options='{
    {{#ifAll @root.request.params.query.location @root.request.params.query.lat @root.request.params.query.lng ~}}
      "circle": {
        "lat": {{@root.request.params.query.lat}},
        "lng": {{@root.request.params.query.lng}},
        "radius": {{default @root.request.params.query.distance 0}},
        "color": "#9cd986"
      }
    {{/ifAll ~}}
    }'>
    {{#each @root.data.search_data.map_results.hits.hits ~}}
      {{#if _source.geo_vacancy_coords ~}}
        {{#each (arrayify _source.geo_vacancy_coords) ~}}
          {{#if @root.request.params.query.distance ~}}
            {{#compare (itemAt ../fields.distance @index) "<" @root.request.params.query.distance ~}}
              {{> marker lat=lat lng=lon source=../_source index=@index}}
            {{/compare ~}}
          {{else}}
            {{> marker lat=lat lng=lon source=../_source index=@index}}
          {{/if ~}}
        {{/each ~}}
      {{/if ~}}
    {{/each ~}}
  </div>
</div>
{{else}}
<div id="detailed-results-container" class="container-content content-primary-search">
  <div class="search-info mdc-elevation--z1">
    No results could be found, please try a different search query
  </div>
</div>
{{/if ~}}